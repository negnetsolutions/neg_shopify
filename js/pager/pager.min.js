var Pager=function(el,opts){var _=this;this.autopager=!1,this.el=el,this.pager=this.el.querySelector(".neg_shopify_pager"),this.xobj=new XMLHttpRequest,this.xobj.overrideMimeType("application/json"),this.currentPage=0,this.total=el.dataset.total,this.totalPages=Math.floor(this.total/el.dataset.perpage),this.pager&&(this.pagerItems=this.pager.querySelector("ul"),this.fetchOptions={perpage:el.dataset.perpage,id:el.dataset.id,type:el.dataset.type,sort:el.dataset.sort},this.opts=void 0!==opts?opts:{},this.url=el.dataset.endpoint,this.itemsEl=el.querySelector(".items"),this.firstPage=0<_.itemsEl.children.length?1:0,this.sortEl=el.querySelector("#sort_order"),null!==this.sortEl&&this.sortEl.addEventListener("change",function(e){e=e.target.options[e.target.selectedIndex].value;_.fetchOptions.sort=e,_.fetch(0)}),this.fetch=function(page){_.currentPage=parseInt(page);const endpoint=_.getUrl()+"&page="+page;_.buildPager(),history.pushState(null,null,_.buildUrl(page)),_.itemsEl.classList.add("dim"),_.xobj.open("GET",endpoint,!0),_.xobj.onreadystatechange=function(){if(4==_.xobj.readyState&&"200"==_.xobj.status){for(var data=JSON.parse(_.xobj.responseText),fragment=document.createDocumentFragment(),i=0;i<data.items.length;i++){var item=data.items[i],el=createElementFromHTML(item);fragment.appendChild(el)}let scripts=fragment.querySelectorAll("script");for(let n=0;n<scripts.length;n++)eval(scripts[n].innerHTML);const currentLink=_.pager.querySelector(".is-active");currentLink&&currentLink.classList.remove("Loader"),window.requestAnimationFrame(function(){_.itemsEl.innerHTML="",_.itemsEl.appendChild(fragment),_.itemsEl.classList.remove("dim"),_.el.scrollIntoView({block:"start",behavior:"smooth"})})}},_.xobj.send(null)},this.buildUrl=function(e){var t=window.location.pathname;const a=new URLSearchParams(window.location.search);a.set("page",e),0==e&&a.delete("page");e=a.toString();return t+(0<e.length?"?":"")+e},this.buildPager=function(){const e=document.createDocumentFragment();var t=parseInt(9);0<parseInt(_.currentPage)&&(n=createElementFromHTML("<li><a href='"+_.buildUrl(0)+"' class='pager__item pager__item--first' data-page='0'>‹‹ First</a></li>"),e.appendChild(n)),0<=parseInt(_.currentPage)-1&&(el=createElementFromHTML("<li><a href='"+_.buildUrl(parseInt(_.currentPage)-1)+"' class='pager__item pager__item--prev' rel='prev' data-page='"+(parseInt(_.currentPage)-1)+"'>‹‹</a></li>"),e.appendChild(el));var a=Math.ceil(t/2),r=parseInt(_.currentPage),n=r-a;let s=r+t-a;var i=parseInt(_.totalPages);let l=n;for(s>i&&(l+=i-s,s=i),l<0&&(s+=1-l,l=0),l!=i&&0<l&&(el=createElementFromHTML("<li>…</li>"),e.appendChild(el));l<=s&&l<=i;l++){var o=createElementFromHTML("<li><a href='"+_.buildUrl(l)+"' class='pager__item"+(l==parseInt(_.currentPage)?" is-active Loader":"")+"' data-page='"+l+"'>"+(l+1)+"</a></li>");e.appendChild(o)}s<parseInt(_.totalPages)&&(el=createElementFromHTML("<li>…</li>"),e.appendChild(el)),r+1<=parseInt(_.totalPages)&&(el=createElementFromHTML("<li><a href='"+_.buildUrl(parseInt(_.currentPage)+1)+"' class='pager__item pager__item--next' rel='next' data-page='"+(parseInt(_.currentPage)+1)+"'>››</a></li>"),e.appendChild(el)),parseInt(_.currentPage)!=parseInt(_.totalPages)&&(r=createElementFromHTML("<li><a href='"+_.buildUrl(parseInt(_.totalPages))+"' class='pager__item pager__item--last' data-page='"+parseInt(_.totalPages)+"'>Last ››</a></li>"),e.appendChild(r)),_.pagerItems.innerHTML="",_.pagerItems.appendChild(e)},this.getUrl=function(){var e="";for(t in _.fetchOptions)e+="&",e+=t+"="+encodeURIComponent(_.fetchOptions[t]);if(void 0!==_.opts.fetchOptionsCallback){var t,a=_.opts.fetchOptionsCallback.call(_.opts.fetchOptionsCallbackContext);for(t in a)e+="&",e+=t+"="+encodeURIComponent(a[t])}return _.url+"?"+e.substring(1)},window.addEventListener("popstate",function(e){const t=new URLSearchParams(window.location.search);let a=t.get("page");a=a||0,_.fetch(a)}),_.pager.addEventListener("click",function(e){var t=e.target.closest("a");t&&(e.preventDefault(),e.stopPropagation(),_.fetch(t.dataset.page))}),0==_.firstPage&&_.fetch(0))},pagers=document.querySelectorAll(".pager");Array.prototype.forEach.call(pagers,function(e){new Pager(e)});
